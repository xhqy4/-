<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£èˆ¹æ˜Ÿé™…æ¢é™©</title>
    <!-- åœ¨ <style> æ ‡ç­¾ä¸­æ·»åŠ è¿›åº¦æ¡æ ·å¼ -->
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        #viewport {
            width: 50vw;
            height: 50vh;
            overflow: hidden;
            position: relative;
        }

        #game-container {
            position: absolute;
            width: 300vw; /* æ‰©å¤§æ¸¸æˆåŒºåŸŸ */
            height: 300vh; /* æ‰©å¤§æ¸¸æˆåŒºåŸŸ */
            background-color: black;
            background-image: linear-gradient(45deg, #222 25%, transparent 25%, transparent 75%, #222 75%, #222),
                              linear-gradient(45deg, #222 25%, transparent 25%, transparent 75%, #222 75%, #222);
            background-size: 50px 50px;
            background-position: 0 0, 10px 10px;
            border: 2px solid blue;
        }
    

        #player {
            position: absolute;
            font-size: 40px;
            transition: transform 0.1s;
        }

        .trail {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: rgba(0, 100, 255, 0.8);
            border-radius: 50%;
            animation: fadeOut 0.5s linear forwards;
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: scale(1); }
            to { opacity: 0; transform: scale(0.5); }
        }

        .star {
            position: absolute;
            width: 30px; /* å¢å¤§å°ºå¯¸ */
            height: 30px; /* å¢å¤§å°ºå¯¸ */
            background: radial-gradient(circle, rgba(255, 255, 100, 1) 0%, rgba(255, 255, 255, 0) 70%); /* å¢å¼ºäº®åº¦ */
            border-radius: 50%;
            animation: twinkle 0.6s infinite alternate; /* åŠ å¿«é—ªçƒé€Ÿåº¦ */
        }

        @keyframes twinkle {
            from { opacity: 0.6; transform: scale(0.7); } /* è°ƒæ•´åˆå§‹é€æ˜åº¦å’Œå¤§å° */
            to { opacity: 1; transform: scale(1.4); } /* è°ƒæ•´ç»“æŸé€æ˜åº¦å’Œå¤§å° */
        }

        #score { 
            position: absolute;
            top: 10px; /* è·ç¦»é¡¶éƒ¨ 10px */
            right: 10px; /* ä¿®æ”¹ä¸ºè·ç¦»å³ä¾§ 10pxï¼Œç§»åˆ°å³ä¸Šè§’ */
            color: white;
            font-size: 24px;
            font-family: Arial, sans-serif;
        }
        /* æ–°å¢è¡€é‡æ˜¾ç¤ºæ ·å¼ */
        #health {
            position: absolute;
            top: 45px; /* ä½äºå¾—åˆ†ä¸‹æ–¹ */
            right: 10px;
            color: white;
            font-size: 24px;
            font-family: Arial, sans-serif;
        }
        /* æ–°å¢å†²åˆºå†·å´è¿›åº¦æ¡æ ·å¼ */
        #sprint-cooldown { 
            position: absolute;
            bottom: 10px;
            left: 10px;
            width: 200px;
            height: 20px;
            background-color: #333;
            border-radius: 5px;
            overflow: hidden;
        }

        #sprint-cooldown-fill { 
            height: 100%;
            width: 100%;
            background-color: #00ff00;
            transition: width 0.1s linear;
        }
        /* æ–°å¢é™¨çŸ³è‡ªè½¬åŠ¨ç”» */
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        /* æ–°å¢é£èˆ¹é—ªçƒåŠ¨ç”» */
        @keyframes blink {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        </style>
        </head>
        <body>
            <!-- åœ¨ <div id="viewport"> å†…æ·»åŠ è¿›åº¦æ¡å…ƒç´  -->
            <div id="viewport">
                <div id="game-container">
                    <div id="player">ğŸ›¸</div>
                </div>
                <div id="score">å¾—åˆ†: 0</div>
                <!-- æ–°å¢è¡€é‡æ˜¾ç¤ºå…ƒç´  -->
                <div id="health">âš™ï¸âš™ï¸âš™ï¸âš™ï¸âš™ï¸</div>
                <!-- æ–°å¢æ‰£è¡€å†·å´è¿›åº¦æ¡ -->
                <div id="damage-cooldown" style="display: none; position: absolute; top: 80px; right: 10px; width: 200px; height: 20px; background-color: #333; border-radius: 5px; overflow: hidden;">
                    <div id="damage-cooldown-fill" style="height: 100%; width: 100%; background-color: #ff0000; transition: width 0.1s linear;"></div>
                </div>
                <div id="sprint-cooldown">
                    <div id="sprint-cooldown-fill"></div>
                </div>
                <!-- æ–°å¢é‡æ–°å¼€å§‹æŒ‰é’® -->
                <button id="restart-button" style="display: none; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); padding: 10px 20px; font-size: 20px;">é‡æ–°å¼€å§‹</button>
            </div>
            <script>
                const player = document.getElementById('player');
                const scoreElement = document.getElementById('score');
                const viewport = document.getElementById('viewport');
                const gameContainer = document.getElementById('game-container');
                // è·å–è¡€é‡æ˜¾ç¤ºå…ƒç´ 
                const healthElement = document.getElementById('health');
                const sprintCooldown = document.getElementById('sprint-cooldown-fill');
                let score = 0;
                let playerX = gameContainer.offsetWidth / 2; // åˆå§‹åŒ–ç©å®¶ä½ç½®åˆ°æ¸¸æˆå®¹å™¨ä¸­å¿ƒ
                let playerY = gameContainer.offsetHeight / 2; // åˆå§‹åŒ–ç©å®¶ä½ç½®åˆ°æ¸¸æˆå®¹å™¨ä¸­å¿ƒ
                const speed = 2;
                const stars = [];
                // å¢åŠ æ˜Ÿæ˜Ÿæ•°é‡åˆ° 200
                const starCount = 200;
                // æ–°å¢é™¨çŸ³æ•°ç»„
                const asteroids = [];
                // å¢åŠ é™¨çŸ³æ•°é‡åˆ° 50
                const asteroidCount = 20;
                // æ–°å¢ï¼šæœ€å¤§ç§»åŠ¨é€Ÿåº¦
                const maxAsteroidSpeed = 3;
                const keys = {
                    ArrowUp: false,
                    ArrowDown: false,
                    ArrowLeft: false,
                    ArrowRight: false
                };
                // æ–°å¢ï¼šè®°å½•æ¸¸æˆå¼€å§‹æ—¶é—´
                const gameStartTime = Date.now();
                // æ–°å¢ï¼šé™¨çŸ³ç”Ÿæˆå»¶è¿Ÿæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
                const asteroidSpawnDelay = 200;
                // æ–°å¢è¡€é‡å˜é‡ï¼Œåˆå§‹ä¸º 5
                let health = 5;
                // æ–°å¢å†²åˆºç›¸å…³å˜é‡
                let isSprinting = false;
                const sprintDistance = 200; // å†²åˆºè·ç¦»
                let remainingSprint = 0;
                let sprintDirection = { x: 0, y: 0 };
                // æ–°å¢æ‹–å°¾åç§»é‡å˜é‡ï¼Œå¯è°ƒæ•´æ‹–å°¾ç”Ÿæˆä½ç½®
                const trailOffset = { x: 26, y: 30 };
                // æ–°å¢å†²åˆºå†·å´ç›¸å…³å˜é‡ï¼Œè®¾ç½®å†·å´æ—¶é—´ä¸º 3000 æ¯«ç§’
                const sprintCooldownTime = 1500;
                let lastSprintTime = 0;
                // æ–°å¢æ¸¸æˆæš‚åœçŠ¶æ€å˜é‡
                let isGamePaused = false;
                let animationFrameId = null;
                // æ–°å¢æ— æ•Œæ—¶é—´ç›¸å…³å˜é‡
                let isInvincible = false;
                let invincibleEndTime = 0;
                const invincibleDuration = 3000; // æ— æ•ŒæŒç»­æ—¶é—´ 3 ç§’
                // æ–°å¢å†²åˆºæ— æ•Œç›¸å…³å˜é‡
                let isSprintInvincible = false;
                let sprintInvincibleEndTime = 0;

                // æ–°å¢ï¼šæœ€å¤§è¡€é‡
                const maxHealth = 5;

                // æ–°å¢ï¼šå›è¡€è®¡æ—¶å™¨ ID
                let healthRegenTimer = null;

                // è®¾ç½®å¼€å±€ä¸¤ç§’æ— æ•Œ
                isInvincible = true;
                invincibleEndTime = Date.now() + 2000;

                // åˆå§‹åŒ–ç©å®¶ä½ç½®
                updatePlayerPosition();

                // ç”Ÿæˆæ˜Ÿæ˜Ÿå’Œé™¨çŸ³
                for (let i = 0; i < starCount; i++) {
                    createStar();
                }
                // ç§»é™¤åˆå§‹ç”Ÿæˆé™¨çŸ³çš„å¾ªç¯ï¼Œæ”¹ä¸ºåœ¨ gameLoop ä¸­æ§åˆ¶
                
                // ç›‘å¬æŒ‰é”®æŒ‰ä¸‹å’Œé‡Šæ”¾äº‹ä»¶
                document.addEventListener('keydown', (e) => {
                    if (keys.hasOwnProperty(e.key)) {
                        keys[e.key] = true;
                    }
                    // æ·»åŠ  wasd é”®æ”¯æŒ
                    if (e.key === 'w') keys.ArrowUp = true;
                    if (e.key === 's') keys.ArrowDown = true;
                    if (e.key === 'a') keys.ArrowLeft = true;
                    if (e.key === 'd') keys.ArrowRight = true;
                    // ç›‘å¬ç©ºæ ¼é”®æŒ‰ä¸‹äº‹ä»¶ï¼Œè§¦å‘å†²åˆºï¼Œæ·»åŠ å†·å´æ£€æŸ¥
                    if (e.key === ' ' && !isSprinting && Date.now() - lastSprintTime >= sprintCooldownTime) {
                        startSprint();
                        lastSprintTime = Date.now();
                    }
                });

                document.addEventListener('keyup', (e) => {
                    if (keys.hasOwnProperty(e.key)) {
                        keys[e.key] = false;
                    }
                    // æ·»åŠ  wasd é”®é‡Šæ”¾æ”¯æŒ
                    if (e.key === 'w') keys.ArrowUp = false;
                    if (e.key === 's') keys.ArrowDown = false;
                    if (e.key === 'a') keys.ArrowLeft = false;
                    if (e.key === 'd') keys.ArrowRight = false;
                });

                // å¼€å§‹å†²åˆºçš„å‡½æ•°
                function startSprint() {
                    isSprinting = true;
                    remainingSprint = sprintDistance;
                    // è®¡ç®—å†²åˆºæ–¹å‘
                    sprintDirection.x = 0;
                    sprintDirection.y = 0;
                    if (keys.ArrowUp) sprintDirection.y = -1;
                    if (keys.ArrowDown) sprintDirection.y = 1;
                    if (keys.ArrowLeft) sprintDirection.x = -1;
                    if (keys.ArrowRight) sprintDirection.x = 1;
                    
                    // å½’ä¸€åŒ–æ–¹å‘å‘é‡ï¼Œä¿è¯æ–œå‘å†²åˆºè·ç¦»ä¸€è‡´
                    const length = Math.sqrt(sprintDirection.x * sprintDirection.x + sprintDirection.y * sprintDirection.y);
                    if (length > 0) {
                        sprintDirection.x /= length;
                        sprintDirection.y /= length;
                    }
                }

                // æ–°å¢æ‹–å°¾æ•°ç»„
                const trails = [];

                function gameLoop() {
                    if (isGamePaused) return;
                    // æ›´æ–°å†²åˆºå†·å´è¿›åº¦æ¡
                    const cooldownProgress = Math.min(1, (Date.now() - lastSprintTime) / sprintCooldownTime);
                    sprintCooldown.style.width = `${cooldownProgress * 100}%`;

                    // æ£€æŸ¥æ— æ•ŒçŠ¶æ€æ˜¯å¦ç»“æŸ
                    if (isInvincible && Date.now() >= invincibleEndTime) {
                        isInvincible = false;
                    }
                    // æ£€æŸ¥å†²åˆºæ— æ•ŒçŠ¶æ€æ˜¯å¦ç»“æŸ
                    if (isSprintInvincible && Date.now() >= sprintInvincibleEndTime) {
                        isSprintInvincible = false;
                    }
                    // æ ¹æ®æ— æ•ŒçŠ¶æ€æ§åˆ¶é£èˆ¹é—ªçƒï¼ˆä¸åŒ…å«å†²åˆºæ— æ•Œï¼‰
                    if (isInvincible && !isSprintInvincible) {
                        player.style.animation = 'blink 0.5s infinite';
                    } else {
                        player.style.animation = '';
                    }

                    // åœ¨æ¸¸æˆå¼€å§‹ä¸‰ç§’å†…ï¼Œæ§åˆ¶é™¨çŸ³æ•°é‡ä¸è¶…è¿‡åˆå§‹æ•°é‡
                    if (Date.now() - gameStartTime >= asteroidSpawnDelay) {
                        while (asteroids.length < asteroidCount) {
                            createAsteroid();
                        }
                    }

                    if (isSprinting && remainingSprint > 0) {
                        // è¿›è¡Œå†²åˆºç§»åŠ¨
                        const sprintSpeed = 10; // å†²åˆºé€Ÿåº¦
                        playerX += sprintDirection.x * sprintSpeed;
                        playerY += sprintDirection.y * sprintSpeed;
                        remainingSprint -= sprintSpeed;

                        // ç”Ÿæˆæ‹–å°¾
                        createTrail();

                        // è®¾ç½®å†²åˆºæ— æ•Œä¸€ç§’
                        isSprintInvincible = true;
                        sprintInvincibleEndTime = Date.now() + 1000;
                    } else {
                        isSprinting = false;
                        if (keys.ArrowUp) playerY -= speed;
                        if (keys.ArrowDown) playerY += speed;
                        if (keys.ArrowLeft) playerX -= speed;
                        if (keys.ArrowRight) playerX += speed;
                    }

                    // è¾¹ç•Œæ£€æŸ¥
                    playerX = Math.max(0, Math.min(playerX, gameContainer.offsetWidth));
                    playerY = Math.max(0, Math.min(playerY, gameContainer.offsetHeight));

                    updatePlayerPosition();
                    updateViewportPosition();
                    checkCollisions();
                    checkAsteroidCollisions();
                    // æ–°å¢ï¼šæ›´æ–°é™¨çŸ³ä½ç½®
                    updateAsteroidsPosition();
                    // æ£€æŸ¥å›è¡€é€»è¾‘
                    checkHealthForRegen();
                    requestAnimationFrame(gameLoop);
                }

                gameLoop();

                // æ–°å¢ï¼šæ£€æŸ¥è¡€é‡çŠ¶æ€ï¼Œè‹¥æœªæ»¡è¡€åˆ™å¯åŠ¨å›è¡€è®¡æ—¶
                function checkHealthForRegen() {
                    if (health < maxHealth && !healthRegenTimer) {
                        healthRegenTimer = setTimeout(() => {
                            health++;
                            healthElement.textContent = 'âš™ï¸'.repeat(health);
                            healthRegenTimer = null;
                            checkHealthForRegen();
                        }, 15000);
                    }
                }

                // åœ¨æ¸¸æˆå¾ªç¯ä¸­è°ƒç”¨æ£€æŸ¥å‡½æ•°
                function gameLoop() {
                    if (isGamePaused) return;
                    // æ›´æ–°å†²åˆºå†·å´è¿›åº¦æ¡
                    const cooldownProgress = Math.min(1, (Date.now() - lastSprintTime) / sprintCooldownTime);
                    sprintCooldown.style.width = `${cooldownProgress * 100}%`;

                    // æ£€æŸ¥æ— æ•ŒçŠ¶æ€æ˜¯å¦ç»“æŸ
                    if (isInvincible && Date.now() >= invincibleEndTime) {
                        isInvincible = false;
                    }
                    // æ£€æŸ¥å†²åˆºæ— æ•ŒçŠ¶æ€æ˜¯å¦ç»“æŸ
                    if (isSprintInvincible && Date.now() >= sprintInvincibleEndTime) {
                        isSprintInvincible = false;
                    }
                    // æ ¹æ®æ— æ•ŒçŠ¶æ€æ§åˆ¶é£èˆ¹é—ªçƒï¼ˆä¸åŒ…å«å†²åˆºæ— æ•Œï¼‰
                    if (isInvincible && !isSprintInvincible) {
                        player.style.animation = 'blink 0.5s infinite';
                    } else {
                        player.style.animation = '';
                    }

                    // åœ¨æ¸¸æˆå¼€å§‹ä¸‰ç§’å†…ï¼Œæ§åˆ¶é™¨çŸ³æ•°é‡ä¸è¶…è¿‡åˆå§‹æ•°é‡
                    if (Date.now() - gameStartTime >= asteroidSpawnDelay) {
                        while (asteroids.length < asteroidCount) {
                            createAsteroid();
                        }
                    }

                    if (isSprinting && remainingSprint > 0) {
                        // è¿›è¡Œå†²åˆºç§»åŠ¨
                        const sprintSpeed = 10; // å†²åˆºé€Ÿåº¦
                        playerX += sprintDirection.x * sprintSpeed;
                        playerY += sprintDirection.y * sprintSpeed;
                        remainingSprint -= sprintSpeed;

                        // ç”Ÿæˆæ‹–å°¾
                        createTrail();

                        // è®¾ç½®å†²åˆºæ— æ•Œä¸€ç§’
                        isSprintInvincible = true;
                        sprintInvincibleEndTime = Date.now() + 1000;
                    } else {
                        isSprinting = false;
                        if (keys.ArrowUp) playerY -= speed;
                        if (keys.ArrowDown) playerY += speed;
                        if (keys.ArrowLeft) playerX -= speed;
                        if (keys.ArrowRight) playerX += speed;
                    }

                    // è¾¹ç•Œæ£€æŸ¥
                    playerX = Math.max(0, Math.min(playerX, gameContainer.offsetWidth));
                    playerY = Math.max(0, Math.min(playerY, gameContainer.offsetHeight));

                    updatePlayerPosition();
                    updateViewportPosition();
                    checkCollisions();
                    checkAsteroidCollisions();
                    // æ–°å¢ï¼šæ›´æ–°é™¨çŸ³ä½ç½®
                    updateAsteroidsPosition();
                    // æ£€æŸ¥å›è¡€é€»è¾‘
                    checkHealthForRegen();
                    requestAnimationFrame(gameLoop);
                }

                gameLoop();

                function updatePlayerPosition() {
                    player.style.left = playerX + 'px';
                    player.style.top = playerY + 'px';
                }

                function updateViewportPosition() {
                    const viewportHalfWidth = viewport.offsetWidth / 2;
                    const viewportHalfHeight = viewport.offsetHeight / 2;
                    
                    let containerLeft = -playerX + viewportHalfWidth;
                    let containerTop = -playerY + viewportHalfHeight;

                    // è§†å£å·¦è¾¹ç•Œæ£€æŸ¥
                    containerLeft = Math.min(0, containerLeft);
                    // è§†å£ä¸Šè¾¹ç•Œæ£€æŸ¥
                    containerTop = Math.min(0, containerTop);
                    // è§†å£å³è¾¹ç•Œæ£€æŸ¥
                    containerLeft = Math.max(-(gameContainer.offsetWidth - viewport.offsetWidth), containerLeft);
                    // è§†å£ä¸‹è¾¹ç•Œæ£€æŸ¥
                    containerTop = Math.max(-(gameContainer.offsetHeight - viewport.offsetHeight), containerTop);

                    gameContainer.style.left = containerLeft + 'px';
                    gameContainer.style.top = containerTop + 'px';
                }

                function createStar() {
                    const star = document.createElement('div');
                    star.className = 'star';
                    star.style.left = Math.random() * gameContainer.offsetWidth + 'px';
                    star.style.top = Math.random() * gameContainer.offsetHeight + 'px';
                    gameContainer.appendChild(star);
                    stars.push(star);
                }

                function checkCollisions() {
                    const playerRect = player.getBoundingClientRect();
                    
                    for (let i = stars.length - 1; i >= 0; i--) {
                        const star = stars[i];
                        const starRect = star.getBoundingClientRect();
                        
                        if (
                            playerRect.left < starRect.right &&
                            playerRect.right > starRect.left &&
                            playerRect.top < starRect.bottom &&
                            playerRect.bottom > starRect.top
                        ) {
                            // ç¢°æ’å‘ç”Ÿï¼Œç§»é™¤æ˜Ÿæ˜Ÿå¹¶å¢åŠ å¾—åˆ†
                            star.remove();
                            stars.splice(i, 1);
                            score+=10;
                            scoreElement.textContent = `å¾—åˆ†: ${score}`;
                            createStar(); // ç”Ÿæˆæ–°æ˜Ÿæ˜Ÿ
                        }
                    }
                }
                // åˆ›å»ºæ‹–å°¾çš„å‡½æ•°
                function createTrail() {
                    const baseDistance = 20; // æ‹–å°¾ä¸é£èˆ¹çš„åŸºç¡€è·ç¦»

                    // ä½¿ç”¨åç§»é‡è°ƒæ•´æ‹–å°¾ç”Ÿæˆä½ç½®
                    createSingleTrail(
                        playerX - sprintDirection.x * baseDistance + trailOffset.x,
                        playerY - sprintDirection.y * baseDistance + trailOffset.y
                    );
                }

                // è¾…åŠ©å‡½æ•°ï¼Œç”¨äºåˆ›å»ºå•ä¸ªæ‹–å°¾
                function createSingleTrail(x, y) {
                    const trail = document.createElement('div');
                    trail.className = 'trail';
                    trail.style.left = x + 'px';
                    trail.style.top = y + 'px';
                    gameContainer.appendChild(trail);
                    trails.push(trail);

                    // ç§»é™¤è¿‡æœŸçš„æ‹–å°¾
                    setTimeout(() => {
                        trail.remove();
                        const index = trails.indexOf(trail);
                        if (index > -1) {
                            trails.splice(index, 1);
                        }
                    }, 500);
                }

                // ä¿®æ”¹æ£€æŸ¥é™¨çŸ³ç¢°æ’å‡½æ•°ï¼Œç§»é™¤é™¨çŸ³æ¶ˆå¤±é€»è¾‘
                function checkAsteroidCollisions() {
                    const playerRect = player.getBoundingClientRect();
                    // æ£€æŸ¥æ— æ•ŒçŠ¶æ€æ˜¯å¦ç»“æŸ
                    if (isInvincible && Date.now() >= invincibleEndTime) {
                        isInvincible = false;
                    }
                    // æ£€æŸ¥å†²åˆºæ— æ•ŒçŠ¶æ€æ˜¯å¦ç»“æŸ
                    if (isSprintInvincible && Date.now() >= sprintInvincibleEndTime) {
                        isSprintInvincible = false;
                    }
                    for (let i = asteroids.length - 1; i >= 0; i--) {
                        const asteroid = asteroids[i];
                        const asteroidRect = asteroid.getBoundingClientRect();
                        if ( 
                            playerRect.left < asteroidRect.right &&
                            playerRect.right > asteroidRect.left &&
                            playerRect.top < asteroidRect.bottom &&
                            playerRect.bottom > asteroidRect.top
                        ) {
                            // å¦‚æœä¸åœ¨æ— æ•ŒçŠ¶æ€ä¸”ä¸åœ¨å†²åˆºæ— æ•ŒçŠ¶æ€ï¼Œå‡å°‘è¡€é‡å¹¶è¿›å…¥æ— æ•ŒçŠ¶æ€
                            if (!isInvincible && !isSprintInvincible) {
                                health--;
                                isInvincible = true;
                                invincibleEndTime = Date.now() + invincibleDuration;
                                // æ›´æ–°è¡€é‡æ˜¾ç¤º
                                healthElement.textContent = 'âš™ï¸'.repeat(health);
                                
                                // æ˜¾ç¤ºæ‰£è¡€å†·å´è¿›åº¦æ¡
                                const damageCooldown = document.getElementById('damage-cooldown');
                                const damageCooldownFill = document.getElementById('damage-cooldown-fill');
                                damageCooldown.style.display = 'block';
                                damageCooldownFill.style.width = '100%';
                                
                                // è®¾ç½® 15 ç§’çš„å†·å´æ—¶é—´
                                const cooldownTime = 15000;
                                const startTime = Date.now();
                                
                                const updateCooldown = () => {
                                    const elapsed = Date.now() - startTime;
                                    const progress = 1 - (elapsed / cooldownTime);
                                    
                                    if (progress > 0) {
                                        damageCooldownFill.style.width = `${progress * 100}%`;
                                        requestAnimationFrame(updateCooldown);
                                    } else {
                                        damageCooldown.style.display = 'none';
                                    }
                                };
                                
                                updateCooldown();
                                
                                // å¦‚æœè¡€é‡ä¸º 0ï¼Œæ˜¾ç¤ºé‡æ–°å¼€å§‹æŒ‰é’®å¹¶æš‚åœæ¸¸æˆ
                                if (health <= 0) {
                                    document.getElementById('restart-button').style.display = 'block';
                                    isGamePaused = true;
                                }
                            }
                            break;
                        }
                    }
                }

                // ä¿®æ”¹æ›´æ–°é™¨çŸ³ä½ç½®çš„å‡½æ•°ï¼Œè®©é™¨çŸ³ç¢°åˆ°è¾¹ç¼˜æ¶ˆå¤±
                function updateAsteroidsPosition() {
                    for (let i = asteroids.length - 1; i >= 0; i--) {
                        const asteroid = asteroids[i];
                        const x = parseFloat(asteroid.style.left) + asteroid.speedX;
                        const y = parseFloat(asteroid.style.top) + asteroid.speedY;
                        const size = parseInt(asteroid.style.fontSize);
                        
                        // æ£€æŸ¥æ˜¯å¦ç¢°åˆ°åœ°å›¾è¾¹ç¼˜ï¼Œè‹¥ç¢°åˆ°åˆ™ç§»é™¤é™¨çŸ³
                        if (x < 0 || x > gameContainer.offsetWidth - size || y < 0 || y > gameContainer.offsetHeight - size) {
                            asteroid.remove();
                            asteroids.splice(i, 1);
                            // è‹¥å·²è¿‡å»¶è¿Ÿæ—¶é—´ï¼Œç”Ÿæˆæ–°é™¨çŸ³
                            if (Date.now() - gameStartTime >= asteroidSpawnDelay) {
                                createAsteroid();
                            }
                        } else {
                            asteroid.style.left = `${x}px`;
                            asteroid.style.top = `${y}px`;
                        }
                    }
                }

                // æ–°å¢åˆ›å»ºé™¨çŸ³å‡½æ•°
                function createAsteroid() {
                    // è·å–å½“å‰è§†å£ä½ç½®å’Œå¤§å°
                    const viewportLeft = -parseInt(gameContainer.style.left) || 0;
                    const viewportTop = -parseInt(gameContainer.style.top) || 0;
                    const viewportWidth = viewport.offsetWidth;
                    const viewportHeight = viewport.offsetHeight;
                
                    // å®šä¹‰è§†å£å¤–ä¸€åœˆçš„åç§»é‡
                    const offset = 10;
                    
                    // éšæœºé€‰æ‹©è§†å£çš„å››æ¡è¾¹ä¹‹ä¸€ï¼Œåœ¨è¯¥è¾¹å¤–ä¾§ç”Ÿæˆé™¨çŸ³
                    const side = Math.floor(Math.random() * 4);
                    let x, y;
                    
                    switch(side) {
                        case 0: // ä¸Šä¾§
                            x = viewportLeft + Math.random() * viewportWidth;
                            y = viewportTop - offset;
                            break;
                        case 1: // ä¸‹ä¾§
                            x = viewportLeft + Math.random() * viewportWidth;
                            y = viewportTop + viewportHeight + offset;
                            break;
                        case 2: // å·¦ä¾§
                            x = viewportLeft - offset;
                            y = viewportTop + Math.random() * viewportHeight;
                            break;
                        case 3: // å³ä¾§
                            x = viewportLeft + viewportWidth + offset;
                            y = viewportTop + Math.random() * viewportHeight;
                            break;
                    }
                
                    // ç¡®ä¿åæ ‡åœ¨æ¸¸æˆå®¹å™¨èŒƒå›´å†…
                    x = Math.max(0, Math.min(x, gameContainer.offsetWidth));
                    y = Math.max(0, Math.min(y, gameContainer.offsetHeight));
                
                    const asteroid = document.createElement('div');
                    asteroid.className = 'asteroid';
                    asteroid.textContent = 'ğŸª¨';
                    asteroid.style.position = 'absolute';
                    asteroid.style.left = `${x}px`;
                    asteroid.style.top = `${y}px`;
                    asteroid.style.fontSize = `${Math.floor(Math.random() * 30) + 20}px`; // éšæœºå¤§å° 20-49px
                    asteroid.style.animation = 'rotate 5s linear infinite'; // åº”ç”¨æ—‹è½¬åŠ¨ç”»
                    
                    // éšæœºé€Ÿåº¦ï¼Œæ–¹å‘æŒ‡å‘è§†å£å†…
                    const directionX = (viewportLeft + viewportWidth / 2 - x) > 0 ? 1 : -1;
                    const directionY = (viewportTop + viewportHeight / 2 - y) > 0 ? 1 : -1;
                    asteroid.speedX = (Math.random() * maxAsteroidSpeed) * directionX;
                    asteroid.speedY = (Math.random() * maxAsteroidSpeed) * directionY;
                    
                    gameContainer.appendChild(asteroid);
                    asteroids.push(asteroid);
                }
                function restartGame() {
            health = 5;
            healthElement.textContent = 'âš™ï¸'.repeat(health);
            score = 0;
            scoreElement.textContent = `å¾—åˆ†: ${score}`;
            playerX = gameContainer.offsetWidth / 2;
            playerY = gameContainer.offsetHeight / 2;
            updatePlayerPosition();
            
            // ç§»é™¤æ‰€æœ‰ç°æœ‰é™¨çŸ³
            asteroids.forEach(asteroid => asteroid.remove());
            asteroids.length = 0;
            
            // é‡æ–°ç”Ÿæˆé™¨çŸ³
            for (let i = 0; i < asteroidCount; i++) {
                createAsteroid();
            }
            
            document.getElementById('restart-button').style.display = 'none';
            // æ¢å¤æ¸¸æˆ
            isGamePaused = false;
            if (!animationFrameId) {
                animationFrameId = requestAnimationFrame(gameLoop);
            }
        }

        // æ·»åŠ é‡æ–°å¼€å§‹æŒ‰é’®ç‚¹å‡»äº‹ä»¶ç›‘å¬
        document.getElementById('restart-button').addEventListener('click', restartGame);
            </script>
        </body>
        </html>


